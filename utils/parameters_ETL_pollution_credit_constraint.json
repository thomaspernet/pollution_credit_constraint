{"GLOBAL": {"DESCRIPTION": "Study how a bank\u2019s involvement in a firm's financing may be in line with environmental policies pursued by the Chinese central government. The Chinese government imposes critical pollution emission objectives during the 11th Five-Year-Plan (2006-2010). The objective of pollution emission was a success and we study one potential mechanism to explain this achievement. One candidate we want to analyse is the role of banks to relocate capital between industry, avoiding financing none environment-friendly project", "GITHUB": {"owner": "thomaspernet", "repo_name": "pollution_credit_constraint"}, "DATABASE": "", "QUERIES_OUTPUT": "SQL_OUTPUT_ATHENA"}, "TABLES": {"CREATION": {"ALL_SCHEMA": [{"description": "Use the spreadsheet to download spatia relocation data. In the spreadsheet, construct the dummy as in the notebook to avoid computing it with Athena", "schema": [{"Name": "citycn", "Type": "float", "Comment": ""}, {"Name": "geocode4_corr", "Type": "float", "Comment": ""}, {"Name": "d_avg_ij_o_city_mandate", "Type": "float", "Comment": ""}, {"Name": "avg_ij_o_city_mandate", "Type": "float", "Comment": ""}], "partition_keys": [], "metadata": {"DatabaseName": "policy", "TablePrefix": "china_", "TableName": "china_spatial_relocation", "target_S3URI": "s3://datalake-datascience/DATA/ENVIRONMENT/CHINA/FYP/SPATIAL_RELOCATION", "from_athena": "False", "filename": "china_cities_target_so2.py", "github_url": "https://github.com/thomaspernet/pollution_credit_constraint/01_data_preprocessing/00_download_data/TARGET_SO2/china_cities_target_so2.py"}}, {"description": "Download socb loan", "schema": [{"Name": "bank", "Type": "string", "Comment": "Chinese bank \u4e2d\u56fd\u519c\u4e1a \u4e2d\u56fd\u5de5\u5546 \u4e2d\u56fd\u5efa\u8bbe or \u4e2d\u56fd\u94f6\u884c"}, {"Name": "province_cn", "Type": "string", "Comment": "province chinese name"}, {"Name": "province_en", "Type": "string", "Comment": "province english name"}, {"Name": "url", "Type": "string", "Comment": "google drive source file"}, {"Name": "year", "Type": "string", "Comment": "Year of the loan"}, {"Name": "loan", "Type": "float", "Comment": "loan in \u4ebf"}, {"Name": "metrics", "Type": "string", "Comment": "metric display either \u4ebf or \u4e07"}], "partition_keys": [], "metadata": {"DatabaseName": "almanac_bank_china", "TablePrefix": "bank_", "TableName": "bank_socb_loan", "target_S3URI": "s3://datalake-datascience/DATA/ECON/ALMANAC_OF_CHINA_FINANCE_BANKING/PROVINCES/SOCB_LOAN", "from_athena": "False", "filename": "socb_loan.py", "github_url": "https://github.com/thomaspernet/pollution_credit_constraint/01_data_preprocessing/00_download_data/ALMANAC_BANK_LOAN/socb_loan.py"}}, {"description": "Download province loan and deposit data", "schema": [{"Name": "province_cn", "Type": "string", "Comment": "province chinese name"}, {"Name": "province_en", "Type": "string", "Comment": "province english name"}, {"Name": "url", "Type": "string", "Comment": "google drive source file"}, {"Name": "year", "Type": "string", "Comment": "year"}, {"Name": "cn_total_deposit", "Type": "string", "Comment": "Chinese character to match total deposit"}, {"Name": "cn_total_loan", "Type": "string", "Comment": "Chinese character to match total loan"}, {"Name": "cn_total_bank_loan", "Type": "string", "Comment": "Chinese character to match total bank loan"}, {"Name": "cn_total_short_term", "Type": "string", "Comment": "Chinese character to match total short term loan"}, {"Name": "cn_total_long_term_loan", "Type": "string", "Comment": "Chinese character to match total long term loan"}, {"Name": "cn_total_gdp", "Type": "string", "Comment": "Chinese character to match total gdp"}, {"Name": "total_deposit", "Type": "float", "Comment": "total deposit"}, {"Name": "total_loan", "Type": "float", "Comment": "total loan"}, {"Name": "total_bank_loan", "Type": "float", "Comment": "total bank loan"}, {"Name": "total_short_term", "Type": "float", "Comment": "total short term loan"}, {"Name": "total_long_term_loan", "Type": "float", "Comment": "total long term loan"}, {"Name": "total_gdp", "Type": "float", "Comment": "total gdp"}, {"Name": "metric", "Type": "string", "Comment": "metric"}], "partition_keys": [], "metadata": {"DatabaseName": "almanac_bank_china", "TablePrefix": "province_", "TableName": "province_loan_and_credit", "target_S3URI": "s3://datalake-datascience/DATA/ECON/ALMANAC_OF_CHINA_FINANCE_BANKING/PROVINCES/LOAN_AND_CREDIT", "from_athena": "False", "filename": "provinces.py", "github_url": "https://github.com/thomaspernet/pollution_credit_constraint/01_data_preprocessing/00_download_data/ALMANAC_BANK_LOAN/provinces.py"}}]}, "PREPARATION": {"STEPS": []}, "TRANSFORMATION": {"STEPS": [{"description": "\nTransform fin dep pollution baseline industry table by merging china_city_reduction_mandate and others\nvariables. Based on https://github.com/thomaspernet/Financial_dependency_pollution/blob/master/01_data_preprocessing/02_transform_tables/04_fin_dep_pol_baseline_city.md\n", "query": "\nCREATE TABLE environment.fin_dep_pollution_baseline_industry WITH (format = 'PARQUET') AS\nWITH aggregate_pol AS (\nSELECT \n    year, \n    geocode4_corr, \n    TRIM(province_en) AS province_en, \n    cityen, \n    -- indus_code AS cic,\n    ind2, \n    SUM(tso2) as tso2, \n    lower_location, \n    larger_location, \n    coastal \n  FROM \n    (\n      SELECT \n        year, \n        province_en, \n        citycode, \n        geocode4_corr, \n        china_city_sector_pollution.cityen, \n        --indus_code,\n        ind2,  \n        tso2, \n        lower_location, \n        larger_location, \n        coastal \n      FROM \n        environment.china_city_sector_pollution \n        INNER JOIN (\n          SELECT \n            extra_code, \n            geocode4_corr,\n          province_en\n          FROM \n            chinese_lookup.china_city_code_normalised \n          GROUP BY \n            extra_code, \n            geocode4_corr,\n          province_en\n        ) as no_dup_citycode ON china_city_sector_pollution.citycode = no_dup_citycode.extra_code\n    ) \n  GROUP BY \n    year, \n    province_en, \n    geocode4_corr, \n    cityen, \n    --indus_code,\n    ind2, \n    lower_location, \n    larger_location, \n    coastal\n) \nSELECT \n  aggregate_pol.year, \n  CASE WHEN aggregate_pol.year in (\n    '1998','1999','2000','2001', '2002', '2003', '2004', '2005'\n  ) THEN 'FALSE' WHEN aggregate_pol.year in ('2006', '2007') THEN 'TRUE' END AS period, \n  aggregate_pol.province_en, \n  cityen, \n  aggregate_pol.geocode4_corr, \n  CASE WHEN tcz IS NULL THEN '0' ELSE tcz END AS tcz, \n  CASE WHEN spz IS NULL OR spz = '#N/A' THEN '0' ELSE spz END AS spz, \n  --aggregate_pol.cic, \n  aggregate_pol.ind2, \n  CASE WHEN short IS NULL THEN 'Unknown' ELSE short END AS short, \n  polluted_d50i, \n  polluted_d75i, \n  polluted_d80i, \n  polluted_d85i, \n  polluted_d90i, \n  polluted_d95i, \n  polluted_mi,\n  polluted_d50_cit, \n  polluted_d75_cit, \n  polluted_d80_cit, \n  polluted_d85_cit, \n  polluted_d90_cit, \n  polluted_d95_cit, \n  polluted_m_cit,\n  tso2, \n  CAST(\n    tso2 AS DECIMAL(16, 5)\n  ) / CAST(\n    output AS DECIMAL(16, 5)\n  ) AS so2_intensity, \n  tso2_mandate_c,\n  above_threshold_mandate,\n  above_average_mandate,\n  avg_ij_o_city_mandate,\n  CASE WHEN d_avg_ij_o_city_mandate IS NULL THEN 'FALSE' ELSE d_avg_ij_o_city_mandate END AS d_avg_ij_o_city_mandate,\n  in_10_000_tonnes, \n  credit_constraint,\n  financial_dep_us,\n  liquidity_need_us,\n  rd_intensity_us,\n  1/supply_all_credit as supply_all_credit,\n  1/supply_long_term_credit as supply_long_term_credit,\n  share_big_bank_loan,\n  lag_share_big_bank_loan,\n  share_big_loan,\n  lag_share_big_loan,\n  credit_supply,\n  lag_credit_supply,\n  credit_supply_long_term,\n  lag_credit_supply_long_term,\n  credit_supply_short_term,\n  lag_credit_supply_short_term,\n  output,\n  sales,\n  employment,\n  capital,\n  current_asset,\n  tofixed,\n  total_liabilities,\n  total_asset,\n  tangible,\n  cashflow,\n  current_ratio,\n  lag_current_ratio,\n  liabilities_tot_asset,\n  sales_tot_asset,\n  lag_sales_tot_asset,\n  asset_tangibility_tot_asset,\n  lag_liabilities_tot_asset,\n  cashflow_to_tangible,\n  lag_cashflow_to_tangible,\n  cashflow_tot_asset,\n  lag_cashflow_tot_asset,\n  return_to_sale,\n  lag_return_to_sale,\n  lower_location, \n  larger_location, \n  coastal,\n  dominated_output_soe_c,\n  dominated_employment_soe_c,\n  dominated_sales_soe_c,\n  dominated_capital_soe_c,\n  dominated_output_for_c,\n  dominated_employment_for_c,\n  dominated_sales_for_c,\n  dominated_capital_for_c,  \n  dominated_output_i,\n  dominated_employ_i,\n  dominated_sales_i,\n  dominated_capital_i,\n  dominated_output_soe_i,\n  dominated_employment_soe_i,\n  dominated_sales_soe_i,\n  dominated_capital_soe_i,\n  dominated_output_for_i,\n  dominated_employment_for_i,\n  dominated_sales_for_i,\n  dominated_capital_for_i,  \n  DENSE_RANK() OVER (\n    ORDER BY \n      city_mandate.geocode4_corr, \n      aggregate_pol.ind2\n  ) AS fe_c_i, \n  DENSE_RANK() OVER (\n    ORDER BY \n      aggregate_pol.year, \n      aggregate_pol.ind2\n  ) AS fe_t_i, \n  DENSE_RANK() OVER (\n    ORDER BY \n      city_mandate.geocode4_corr, \n      aggregate_pol.year\n  ) AS fe_c_t \nFROM \n  aggregate_pol \n  INNER JOIN (\n  SELECT \n  indu_2,\n  current_asset,\n  tofixed,\n  total_liabilities,\n  total_asset,\n  tangible,\n  cashflow,\n  current_ratio,\n  lag_current_ratio,\n  liabilities_tot_asset,\n  sales_tot_asset,\n  lag_sales_tot_asset,\n  asset_tangibility_tot_asset,\n  lag_liabilities_tot_asset,\n  cashflow_to_tangible,\n  lag_cashflow_to_tangible,\n  cashflow_tot_asset,\n  lag_cashflow_tot_asset,\n  return_to_sale,\n  lag_return_to_sale\n    \n  FROM firms_survey.asif_industry_financial_ratio_industry \n  WHERE year = '2002'\n  ) AS asif_industry_financial_ratio_industry\n  ON \n  aggregate_pol.ind2 = asif_industry_financial_ratio_industry.indu_2 \n  INNER JOIN (\n    SELECT \n  geocode4_corr, \n  tso2_mandate_c, \n  in_10_000_tonnes, \n  MAP(\n    ARRAY[.5, \n    .75, \n    .90, \n    .95 ], \n    zip_with(\n      transform(\n        sequence(1, 4), \n        x -> tso2_mandate_c\n      ), \n      tso2_mandate_c_pct, \n      (x, y) -> x < y\n    )\n  ) AS above_threshold_mandate, \n  CASE WHEN tso2_mandate_c > tso2_mandate_c_avg THEN 'ABOVE' ELSE 'BELOW' END AS above_average_mandate \nFROM \n  (\n    (\n      SELECT \n        'TEMP' as temp, \n        approx_percentile(\n          tso2_mandate_c, ARRAY[.5,.75,.90, \n          .95]\n        ) AS tso2_mandate_c_pct, \n        AVG(tso2_mandate_c) AS tso2_mandate_c_avg \n      FROM \n        policy.china_city_reduction_mandate\n    ) as percentile \n    LEFT JOIN (\n      SELECT \n        'TEMP' as temp, \n        citycn, \n        tso2_mandate_c, \n        in_10_000_tonnes \n      FROM \n        policy.china_city_reduction_mandate\n    ) as mandate ON percentile.temp = mandate.temp\n  ) as map_mandate\n  INNER JOIN chinese_lookup.china_city_code_normalised ON map_mandate.citycn = china_city_code_normalised.citycn \n    WHERE \n      extra_code = geocode4_corr\n  ) as city_mandate ON aggregate_pol.geocode4_corr = city_mandate.geocode4_corr \n  LEFT JOIN policy.china_city_tcz_spz ON aggregate_pol.geocode4_corr = china_city_tcz_spz.geocode4_corr \n  LEFT JOIN chinese_lookup.ind_cic_2_name ON aggregate_pol.ind2 = ind_cic_2_name.cic \n  LEFT JOIN (\n    SELECT \n      ind2, \n      year,\n      polluted_d50i, \n      polluted_d75i, \n      polluted_d80i, \n      polluted_d85i, \n      polluted_d90i, \n      polluted_d95i, \n      polluted_mi\n    FROM \n      \"environment\".\"china_sector_pollution_threshold\" \n\n  ) as polluted_sector ON aggregate_pol.ind2 = polluted_sector.ind2 \n  and aggregate_pol.year = polluted_sector.year \n  LEFT JOIN (\n    SELECT \n      ind2, \n      year,\n      geocode4_corr,\n      polluted_d50_cit, \n      polluted_d75_cit, \n      polluted_d80_cit, \n      polluted_d85_cit, \n      polluted_d90_cit, \n      polluted_d95_cit, \n      polluted_m_cit\n    FROM \n      \"environment\".\"china_city_sector_year_pollution_threshold\" \n\n  ) as polluted_sector_cit ON aggregate_pol.ind2 = polluted_sector_cit.ind2 \n  and aggregate_pol.year = polluted_sector_cit.year \n  and aggregate_pol.geocode4_corr = polluted_sector_cit.geocode4_corr \n  LEFT JOIN (\n    SELECT \n      cic, \n      financial_dep_china AS credit_constraint,\n      financial_dep_us,\n      liquidity_need_us,\n      rd_intensity_us \n    FROM \n      industry.china_credit_constraint\n  ) as cred_constraint ON aggregate_pol.ind2 = cred_constraint.cic \n  LEFT JOIN (\n    SELECT \n      year, \n      geocode4_corr, \n      indu_2,\n      SUM(output) AS output,\n      SUM(employ) AS employment, \n      SUM(captal) AS capital,\n      SUM(sales) as sales\nFROM(\nSELECT \n  firm, \n  year, \n  geocode4_corr, \n  CASE WHEN LENGTH(cic) = 4 THEN substr(cic, 1, 2) ELSE concat(\n    '0', \n    substr(cic, 1, 1)\n  ) END AS indu_2, \n  output, \n  employ, \n  captal, \n  sales, \n  toasset \nFROM \n  firms_survey.asif_firms_prepared \n  INNER JOIN (\n    SELECT \n      extra_code, \n      geocode4_corr \n    FROM \n      chinese_lookup.china_city_code_normalised \n    GROUP BY \n      extra_code, \n      geocode4_corr\n  ) as no_dup_citycode ON asif_firms_prepared.citycode = no_dup_citycode.extra_code\n  )\n  WHERE \n      year in (\n      '1998', '1999', '2000',\n        '2001', '2002', '2003', '2004', '2005', \n        '2006', '2007'\n      ) \n    GROUP BY \n    year, \n      geocode4_corr, \n      indu_2\n  ) as agg_output ON aggregate_pol.geocode4_corr = agg_output.geocode4_corr \n  AND aggregate_pol.ind2 = agg_output.indu_2 \n  AND aggregate_pol.year = agg_output.year \n  LEFT JOIN firms_survey.asif_industry_characteristics_ownership\n    ON aggregate_pol.geocode4_corr = asif_industry_characteristics_ownership.geocode4_corr\n    AND aggregate_pol.ind2 = asif_industry_characteristics_ownership.indu_2\n  LEFT JOIN firms_survey.asif_city_characteristics_ownership\n    ON aggregate_pol.geocode4_corr = asif_city_characteristics_ownership.geocode4_corr\n  LEFT JOIN chinese_lookup.province_credit_constraint ON aggregate_pol.province_en = province_credit_constraint.Province\n  LEFT JOIN (\n    SELECT geocode4_corr, avg_ij_o_city_mandate, d_avg_ij_o_city_mandate \nFROM \"policy\".\"china_spatial_relocation\"\n    ) as relocation\n    ON aggregate_pol.geocode4_corr = relocation.geocode4_corr\nLEFT JOIN (\n    SELECT \n  year, \n  province_en, \n  share_big_bank_loan, \n  LAG(share_big_bank_loan, 1) OVER (\n    PARTITION BY province_en \n    ORDER BY \n      year\n  ) as lag_share_big_bank_loan, \n  share_big_loan, \n  LAG(share_big_loan, 1) OVER (\n    PARTITION BY province_en \n    ORDER BY \n      year\n  ) as lag_share_big_loan, \n  credit_supply, \n  LAG(credit_supply, 1) OVER (\n    PARTITION BY province_en \n    ORDER BY \n      year\n  ) as lag_credit_supply, \n  credit_supply_long_term, \n  LAG(credit_supply_long_term, 1) OVER (\n    PARTITION BY province_en \n    ORDER BY \n      year\n  ) as lag_credit_supply_long_term, \n  credit_supply_short_term, \n  LAG(credit_supply_short_term, 1) OVER (\n    PARTITION BY province_en \n    ORDER BY \n      year\n  ) as lag_credit_supply_short_term \nFROM \n  (\n    SELECT \n      province_loan_and_credit.year, \n      province_loan_and_credit.province_en, \n      CAST(\n        total_loan_big_four AS DECIMAL(16, 5)\n      )/ CAST(\n        total_bank_loan AS DECIMAL(16, 5)\n      ) AS share_big_bank_loan, \n      CAST(\n        total_loan_big_four AS DECIMAL(16, 5)\n      )/ CAST(\n        total_loan AS DECIMAL(16, 5)\n      ) AS share_big_loan, \n      CAST(\n        total_bank_loan AS DECIMAL(16, 5)\n      )/ CAST(\n        total_gdp AS DECIMAL(16, 5)\n      ) AS credit_supply, \n      CAST(\n        total_long_term_loan AS DECIMAL(16, 5)\n      )/ CAST(\n        total_gdp AS DECIMAL(16, 5)\n      ) AS credit_supply_long_term, \n      CAST(\n        total_short_term AS DECIMAL(16, 5)\n      )/ CAST(\n        total_gdp AS DECIMAL(16, 5)\n      ) AS credit_supply_short_term \n    FROM \n      almanac_bank_china.province_loan_and_credit \n      LEFT JOIN (\n        SELECT \n          province_en, \n          year, \n          share[ '\u4e2d\u56fd\u519c\u4e1a' ] + share[ '\u4e2d\u56fd\u94f6\u884c' ] + share[ '\u4e2d\u56fd\u5de5\u5546' ] + share[ '\u4e2d\u56fd\u5efa\u8bbe' ] as total_loan_big_four \n        FROM \n          (\n            SELECT \n              province_en, \n              year, \n              map_agg(bank, loan) as share \n            FROM \n              \"almanac_bank_china\".\"bank_socb_loan\" \n            GROUP BY \n              province_en, \n              year\n          )\n      ) as big_four ON province_loan_and_credit.year = big_four.year \n      AND province_loan_and_credit.province_en = big_four.province_en\n  )\n  ) as credit ON aggregate_pol.year = credit.year \n  AND aggregate_pol.province_en = credit.province_en \nWHERE \n  tso2 > 0 \n  AND output > 0 \n  and capital > 0 \n  and employment > 0\n  and current_ratio > 0\n  and cashflow_to_tangible > 0\n  AND aggregate_pol.ind2 != '43'\n", "schema": [{"Name": "year", "Type": "string", "Comment": "year from 2001 to 2007"}, {"Name": "period", "Type": "varchar(5)", "Comment": "False if year before 2005 included, True if year 2006 and 2007"}, {"Name": "province_en", "Type": "string", "Comment": ""}, {"Name": "cityen", "Type": "string", "Comment": ""}, {"Name": "geocode4_corr", "Type": "string", "Comment": ""}, {"Name": "tcz", "Type": "string", "Comment": "Two control zone policy city"}, {"Name": "spz", "Type": "string", "Comment": "Special policy zone policy city"}, {"Name": "ind2", "Type": "string", "Comment": "2 digits industry"}, {"Name": "short", "Type": "string", "Comment": ""}, {"Name": "polluted_d50i", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 50th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_d80i", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 80th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_d85i", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 85th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_d90i", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 90th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_d95i", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 95th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_mi", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly average of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_d50_cit", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 50th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_d80_cit", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 80th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_d85_cit", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 85th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_d90_cit", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 90th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_d95_cit", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly 95th percentile of SO2 label as ABOVE else BELOW"}, {"Name": "polluted_m_cit", "Type": "varchar(5)", "Comment": "Sectors with values above Yearly average of SO2 label as ABOVE else BELOW"}, {"Name": "tso2", "Type": "bigint", "Comment": "Total so2 city sector. Filtered values above  4863 (5% of the distribution)"}, {"Name": "so2_intensity", "Type": "decimal(21,5)", "Comment": "SO2 divided by output"}, {"Name": "tso2_mandate_c", "Type": "float", "Comment": "city reduction mandate in tonnes"}, {"Name": "above_threshold_mandate", "Type": "map<double,boolean>", "Comment": "Policy mandate above percentile .5, .75, .9, .95"}, {"Name": "avg_ij_o_city_mandate", "Type": "float", "Comment": ""}, {"Name": "d_avg_ij_o_city_mandate", "Type": "string", "Comment": ""}, {"Name": "above_average_mandate", "Type": "varchar(5)", "Comment": "Policy mandate above national average"}, {"Name": "in_10_000_tonnes", "Type": "float", "Comment": "city reduction mandate in 10k tonnes"}, {"Name": "tfp_cit", "Type": "double", "Comment": "TFP at the city industry level. From https://github.com/thomaspernet/Financial_dependency_pollution/blob/master/01_data_preprocessing/02_transform_tables/05_tfp_computation.md#table-asif_tfp_firm_level"}, {"Name": "credit_constraint", "Type": "float", "Comment": "Financial dependency. From paper https://www.sciencedirect.com/science/article/pii/S0147596715000311\""}, {"Name": "financial_dep_us", "Type": "float", "Comment": "Financial dependency metric based on US data"}, {"Name": "liquidity_need_us", "Type": "float", "Comment": "liquidity need metric based on US data"}, {"Name": "rd_intensity_us", "Type": "float", "Comment": "RD intensity metric based on US data"}, {"Name": "supply_all_credit", "Type": "double", "Comment": "province external supply of credit"}, {"Name": "supply_long_term_credit", "Type": "float", "Comment": "province external supply of long term credit"}, {"Name": "share_big_bank_loan", "Type": "decimal(21,5)", "Comment": "share four State-owned commercial banks in total bank lending"}, {"Name": "lag_share_big_bank_loan", "Type": "decimal(21,5)", "Comment": "lag share four State-owned commercial banks in total bank lending"}, {"Name": "share_big_loan", "Type": "decimal(21,5)", "Comment": "share four State-owned commercial banks in total lending"}, {"Name": "lag_share_big_loan", "Type": "decimal(21,5)", "Comment": "lag share four State-owned commercial banks in total lending"}, {"Name": "credit_supply", "Type": "decimal(21,5)", "Comment": "total bank lending normalised by gdp"}, {"Name": "lag_credit_supply", "Type": "decimal(21,5)", "Comment": "lag total bank lending normalised by gdp"}, {"Name": "credit_supply_long_term", "Type": "decimal(21,5)", "Comment": "total long term bank lending normalised by gdp"}, {"Name": "lag_credit_supply_long_term", "Type": "decimal(21,5)", "Comment": "lag total long term bank lending normalised by gdp"}, {"Name": "credit_supply_short_term", "Type": "decimal(21,5)", "Comment": "total short term bank lending normalised by gdp"}, {"Name": "lag_credit_supply_short_term", "Type": "decimal(21,5)", "Comment": "lag total short term bank lending normalised by gdp"}, {"Name": "output", "Type": "bigint", "Comment": "Output"}, {"Name": "sales", "Type": "bigint", "Comment": "Sales"}, {"Name": "employment", "Type": "bigint", "Comment": "Employemnt"}, {"Name": "capital", "Type": "bigint", "Comment": "Capital"}, {"Name": "current_asset", "Type": "bigint", "Comment": "current asset"}, {"Name": "tofixed", "Type": "bigint", "Comment": "total fixed asset"}, {"Name": "total_liabilities", "Type": "bigint", "Comment": "total liabilities"}, {"Name": "total_asset", "Type": "bigint", "Comment": "total asset"}, {"Name": "tangible", "Type": "bigint", "Comment": "tangible asset"}, {"Name": "cashflow", "Type": "bigint", "Comment": "cash flow"}, {"Name": "current_ratio", "Type": "decimal(21,5)", "Comment": "current ratio"}, {"Name": "lag_current_ratio", "Type": "decimal(21,5)", "Comment": "lag value of current ratio"}, {"Name": "liabilities_tot_asset", "Type": "decimal(21,5)", "Comment": "liabilities to total asset"}, {"Name": "sales_tot_asset", "Type": "decimal(21,5)", "Comment": "sales to total asset"}, {"Name": "lag_sales_tot_asset", "Type": "decimal(21,5)", "Comment": "lag value of sales to asset"}, {"Name": "asset_tangibility_tot_asset", "Type": "decimal(21,5)", "Comment": "asset tangibility tot total asset"}, {"Name": "lag_liabilities_tot_asset", "Type": "decimal(21,5)", "Comment": "Lag liabiliteies to total asset"}, {"Name": "cashflow_to_tangible", "Type": "decimal(21,5)", "Comment": "cash flow to tangible"}, {"Name": "lag_cashflow_to_tangible", "Type": "decimal(21,5)", "Comment": "lag cash flow to tangible"}, {"Name": "cashflow_tot_asset", "Type": "decimal(21,5)", "Comment": "Cash flow to total asset"}, {"Name": "lag_cashflow_tot_asset", "Type": "decimal(21,5)", "Comment": "lag cash flow tot total asset"}, {"Name": "return_to_sale", "Type": "decimal(21,5)", "Comment": "Return to sale"}, {"Name": "lag_return_to_sale", "Type": "decimal(21,5)", "Comment": "Lag return tot sale"}, {"Name": "lower_location", "Type": "string", "Comment": ""}, {"Name": "larger_location", "Type": "string", "Comment": ""}, {"Name": "coastal", "Type": "string", "Comment": "City is bordered by sea or not"}, {"Name": "dominated_output_soe_c", "Type": "boolean", "Comment": "SOE dominated city of output. If true, then SOEs dominated city"}, {"Name": "dominated_employment_soe_c", "Type": "boolean", "Comment": "SOE dominated city of employment. If true, then SOEs dominated city"}, {"Name": "dominated_sales_soe_c", "Type": "boolean", "Comment": "SOE dominated city of sales. If true, then SOEs dominated city"}, {"Name": "dominated_capital_soe_c", "Type": "boolean", "Comment": "SOE dominated city of capital. If true, then SOEs dominated city"}, {"Name": "dominated_output_for_c", "Type": "boolean", "Comment": "foreign dominated city of output. If true, then foreign dominated city"}, {"Name": "dominated_employment_for_c", "Type": "boolean", "Comment": "foreign dominated city of employment. If true, then foreign dominated city"}, {"Name": "dominated_sales_for_c", "Type": "boolean", "Comment": "foreign dominated cityof sales. If true, then foreign dominated city"}, {"Name": "dominated_capital_for_c", "Type": "boolean", "Comment": "foreign dominated city of capital. If true, then foreign dominated city"}, {"Name": "dominated_output_i", "Type": "map<double,boolean>", "Comment": "map with information dominated industry knowing percentile .5, .75, .9, .95 of output"}, {"Name": "dominated_employment_i", "Type": "map<double,boolean>", "Comment": "map with information on dominated industry knowing percentile .5, .75, .9, .95 of employment"}, {"Name": "dominated_capital_i", "Type": "map<double,boolean>", "Comment": "map with information on dominated industry knowing percentile .5, .75, .9, .95 of capital"}, {"Name": "dominated_sales_i", "Type": "map<double,boolean>", "Comment": "map with information on SOE dominated industry knowing percentile .5, .75, .9, .95 of sales"}, {"Name": "dominated_output_soe_i", "Type": "map<double,boolean>", "Comment": "map with information on SOE dominated industry knowing percentile .5, .75, .9, .95 of output"}, {"Name": "dominated_employment_soe_i", "Type": "map<double,boolean>", "Comment": "map with information on SOE dominated industry knowing percentile .5, .75, .9, .95 of employment"}, {"Name": "dominated_sales_soe_i", "Type": "map<double,boolean>", "Comment": "map with information on SOE dominated industry knowing percentile .5, .75, .9, .95 of sales"}, {"Name": "dominated_capital_soe_i", "Type": "map<double,boolean>", "Comment": "map with information on SOE dominated industry knowing percentile .5, .75, .9, .95 of capital"}, {"Name": "dominated_output_for_i", "Type": "map<double,boolean>", "Comment": "map with information on foreign dominated industry knowing percentile .5, .75, .9, .95 of output"}, {"Name": "dominated_employment_for_i", "Type": "map<double,boolean>", "Comment": "map with information on foreign dominated industry knowing percentile .5, .75, .9, .95 of employment"}, {"Name": "dominated_sales_for_i", "Type": "map<double,boolean>", "Comment": "map with information on foreign dominated industry knowing percentile .5, .75, .9, .95 of sales"}, {"Name": "dominated_capital_for_i", "Type": "map<double,boolean>", "Comment": "map with information on foreign dominated industry knowing percentile .5, .75, .9, .95 of capital"}, {"Name": "fe_c_i", "Type": "bigint", "Comment": "City industry fixed effect"}, {"Name": "fe_t_i", "Type": "bigint", "Comment": "year industry fixed effect"}, {"Name": "fe_c_t", "Type": "bigint", "Comment": "city industry fixed effect"}], "partition_keys": ["province_en", "geocode4_corr", "ind2", "year"], "metadata": {"DatabaseName": "environment", "TableName": "fin_dep_pollution_baseline_industry", "input": ["china_city_sector_pollution", "china_city_code_normalised", "asif_industry_financial_ratio_industry", "china_city_reduction_mandate", "china_city_reduction_mandate", "china_city_code_normalised", "china_city_tcz_spz", "ind_cic_2_name", "china_sector_pollution_threshold", "china_city_sector_year_pollution_threshold", "china_credit_constraint", "asif_firms_prepared", "china_city_code_normalised", "asif_industry_characteristics_ownership", "asif_city_characteristics_ownership", "province_credit_constraint", "china_spatial_relocation", "province_loan_and_credit", "bank_socb_loan"], "target_S3URI": "s3://datalake-datascience/DATA/ENVIRONMENT/CHINA/FYP/FINANCIAL_CONTRAINT/PAPER_FYP_FINANCE_POL/BASELINE/INDUSTRY", "from_athena": "True", "filename": "00_credit_constraint_industry.ipynb", "index_final_table": [0], "if_final": "True", "github_url": "https://github.com/thomaspernet/pollution_credit_constraint/blob/master/01_data_preprocessing/02_transform_tables/00_credit_constraint_industry.md"}}]}}, "ANALYSIS": {"COUNT_MISSING": {"top": "SELECT COUNT(*) as nb_obs, ", "middle": "COUNT(*) - COUNT({0}) AS {0}", "bottom": " FROM {}.{}"}, "CATEGORICAL": {"PAIR": "SELECT {2}, COUNT(*) AS nb_obs FROM {0}.{1} GROUP BY {2} ORDER BY nb_obs DESC ", "MULTI_PAIR": "SELECT {2}, {3}, COUNT(*) AS nb_obs FROM {0}.{1} GROUP BY {2}, {3} ORDER BY nb_obs DESC "}, "CONTINUOUS": {"DISTRIBUTION": {"top_1": "SELECT * FROM (WITH table_wrapper AS (", "top_2": ") SELECT table_wrapper.pct,", "top_3": " FROM table_wrapper ", "middle_1": "  LEFT JOIN ( ", "middle_2": " ) as table_2_{0} ON table_wrapper.pct = table_2_{0}.pct ", "bottom": "WITH table_{3} AS ( SELECT MAP( ARRAY[0.25, 0.50, 0.75, 0.95, 0.99], approx_percentile( {2}, ARRAY[0.25, 0.50, 0.75, 0.95, 0.99] ) ) as nest FROM {0}.{1} ) SELECT pct, value AS {2} FROM table_{3} CROSS JOIN UNNEST(nest) AS t(pct, value)"}, "ONE_PAIR_DISTRIBUTION": {"top_1": "SELECT * FROM (WITH table_wrapper AS (", "top_2": ") SELECT table_wrapper.pct, table_wrapper.{}, ", "top_3": " FROM table_wrapper ", "middle_1": "  LEFT JOIN ( ", "middle_2": " ) as table_2_{0} ON table_wrapper.{1} = table_2_{0}.{1} AND table_wrapper.pct = table_2_{0}.pct ", "bottom": "WITH table_{3} AS ( SELECT {4}, MAP(ARRAY[0.25, 0.50, 0.75, 0.95, 0.99], approx_percentile( {2}, ARRAY[0.25, 0.50, 0.75, 0.95, 0.99] ) ) as nest FROM {0}.{1} GROUP BY {4}) SELECT {4}, pct, value AS {2} FROM table_{3} CROSS JOIN UNNEST(nest) AS t(pct, value)"}, "TWO_PAIRS_DISTRIBUTION": "WITH dataset AS ( SELECT {2}, {3}, MAP( ARRAY[0.25, 0.50, 0.75, 0.95, 0.99], approx_percentile( {4}, ARRAY[0.25, 0.50, 0.75, 0.95, 0.99] ) ) as nest FROM {0}.{1} GROUP BY {2}, {3} ) SELECT {2}, {3}, pct, value AS {4} FROM dataset CROSS JOIN UNNEST(nest) AS t(pct, value)"}, "COUNT_DUPLICATES": {"query": "SELECT CNT, COUNT(*) AS CNT_DUPLICATE FROM ( SELECT {2}, COUNT(*) as CNT FROM {0}.{1} GROUP BY {2} ) GROUP BY CNT ORDER BY CNT_DUPLICATE"}}}